var WaveformPlaylist=(()=>{var f=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var v=(l,e)=>{for(var t in e)f(l,t,{get:e[t],enumerable:!0})},E=(l,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of C(e))!g.call(l,s)&&s!==t&&f(l,s,{get:()=>e[s],enumerable:!(a=w(e,s))||a.enumerable});return l};var T=l=>E(f({},"__esModule",{value:!0}),l);var x={};v(x,{WaveformPlaylist:()=>p,default:()=>b});var p=class{constructor(e,t={}){if(this.container=typeof e=="string"?document.querySelector(e):e,!this.container)throw new Error("WaveformPlaylist: Container element not found");if(typeof window.WaveformPlayer>"u")throw new Error("WaveformPlaylist: WaveformPlayer is required but not found");this.options=this.parseOptions(t),this.tracks=[],this.currentTrackIndex=0,this.currentChapterIndex=-1,this.player=null,this.listElement=null,this.isMinimal=this.options.layout==="minimal",this.isPlaying=!1,this.parseTracks(),this.tracks.length>0&&this.init()}parseOptions(e){let t=this.container,a={...e};return["url","waveformStyle","barWidth","barSpacing","height","samples","waveformColor","progressColor","buttonColor","textColor","textSecondaryColor","backgroundColor","borderColor","showTime","showBPM","showPlaybackSpeed","playbackRate","autoplay","singlePlay","playOnSeek","enableMediaSession"].forEach(r=>{let i=t.dataset[r];i!==void 0&&(i==="true"?a[r]=!0:i==="false"?a[r]=!1:a[r]=i)}),a.layout=t.dataset.layout||a.layout||"list",a.continuous=t.dataset.continuous==="true"||a.continuous||!1,a.expandChapters=t.dataset.expandChapters!=="false",a.showDuration=t.dataset.showDuration!=="false",a.showPlayState=t.dataset.showPlayState!=="false",t.dataset.showChapterMarkers!==void 0?a.showChapterMarkers=t.dataset.showChapterMarkers==="true":a.showChapterMarkers=null,a.chapterMarkerColor=t.dataset.chapterMarkerColor||"rgba(168, 85, 247, 0.8)",a}parseTracks(){let e=this.container.querySelectorAll("[data-track]");this.tracks=Array.from(e).map((t,a)=>{let s=Array.from(t.querySelectorAll("[data-chapter]")).map(r=>({time:this.parseTime(r.dataset.time||"0:00"),label:r.textContent.trim(),color:r.dataset.color,element:r}));return{element:t,index:a,url:t.dataset.url,title:t.dataset.title||this.extractTitleFromUrl(t.dataset.url),subtitle:t.dataset.subtitle||"",artwork:t.dataset.artwork,album:t.dataset.album,duration:t.dataset.duration,chapters:s,markers:t.dataset.markers?JSON.parse(t.dataset.markers):[]}})}init(){this.container.classList.add("waveform-playlist"),this.isMinimal&&this.container.classList.add("wp-minimal"),this.tracks.forEach(t=>{t.element&&(t.element.style.display="none")});let e=document.createElement("div");e.className="wp-player",e.id="wp-player-"+this.generateId(),this.container.appendChild(e),this.tracks.length===1&&this.tracks[0].chapters.length>0?this.createChapterList():this.isMinimal?this.createMinimalControls():this.createTrackList(),this.initPlayer(e),this.bindKeyboard()}initPlayer(e){let t=this.tracks[0],a=t.markers;this.options.showChapterMarkers===null&&(this.options.showChapterMarkers=this.tracks.length===1&&t.chapters.length>0),this.options.showChapterMarkers&&t.chapters.length>0&&a.length===0&&(a=t.chapters.map(r=>({time:r.time,label:r.label,color:r.color||this.options.chapterMarkerColor})));let s={...this.options,url:t.url,title:t.title,subtitle:t.subtitle,artwork:t.artwork,album:t.album,markers:a,onEnd:()=>this.onTrackEnd(),onTimeUpdate:(r,i)=>this.updateActiveChapter(r),onPlay:()=>{this.isPlaying=!0,this.setActiveTrack(this.currentTrackIndex),this.updatePlayState()},onPause:()=>{if(this.isPlaying=!1,this.updatePlayState(),this.player&&this.player.audio){let r=this.player.audio.currentTime,i=this.player.audio.duration;r>=i-.1&&(this.currentChapterIndex=-1,this.updateActiveChapter(0))}}};this.player=new window.WaveformPlayer(e,s),this.setActiveTrack(0),this.updateActiveChapter(0)}updatePlayState(){this.options.showPlayState&&this.listElement.querySelectorAll(".wp-artwork-container").forEach((e,t)=>{let a=t===this.currentTrackIndex,s=e.querySelector(".wp-artwork-overlay");if(s){s.style.display=a?"flex":"none";let r=s.querySelector("i");r&&(r.className=this.isPlaying&&a?"ti ti-player-pause":"ti ti-player-play")}})}updateActiveChapter(e){let t=this.tracks[this.currentTrackIndex];if(!t.chapters.length)return;let a=-1;for(let s=t.chapters.length-1;s>=0;s--)if(e>=t.chapters[s].time){a=s;break}if(a!==this.currentChapterIndex){if(this.currentChapterIndex=a,this.tracks.length===1&&t.chapters.length>0)this.listElement.querySelectorAll(".wp-chapter-item").forEach((s,r)=>{s.classList.toggle("wp-active",r===a)});else if(this.tracks.length>1&&this.options.expandChapters){let s=this.listElement.querySelector(`.wp-chapters[data-track-index="${this.currentTrackIndex}"]`);s&&s.querySelectorAll(".wp-chapter").forEach((r,i)=>{r.classList.toggle("wp-active",i===a)})}}}createChapterList(){let e=this.tracks[0],t=document.createElement("div");t.className="wp-list-container";let a=document.createElement("ul");a.className="wp-list wp-chapters-only",e.chapters.forEach((s,r)=>{let i=document.createElement("li");i.className="wp-chapter-item",i.dataset.time=s.time,i.dataset.index=r;let h=document.createElement("span");h.className="wp-time",h.textContent=this.formatTime(s.time),i.appendChild(h);let n=document.createElement("span");n.className="wp-label",n.textContent=s.label,i.appendChild(n),i.addEventListener("click",()=>{this.player.seekTo(s.time),this.player.isPlaying||this.player.play()}),a.appendChild(i)}),t.appendChild(a),this.container.appendChild(t),this.listElement=a}createTrackList(){let e=document.createElement("div");e.className="wp-list-container";let t=document.createElement("ul");t.className="wp-list",this.tracks.forEach((a,s)=>{let r=document.createElement("li");if(r.className="wp-item",r.dataset.index=s,a.artwork){let n=document.createElement("div");n.className="wp-artwork-container";let c=document.createElement("img");if(c.className="wp-artwork",c.src=a.artwork,c.alt=a.title,n.appendChild(c),this.options.showPlayState){let d=document.createElement("div");d.className="wp-artwork-overlay",d.style.display="none";let o=document.createElement("i");o.className="ti ti-player-play",d.appendChild(o),n.appendChild(d)}r.appendChild(n)}else{let n=document.createElement("span");n.className="wp-indicator",n.textContent=s+1,r.appendChild(n)}let i=document.createElement("div");i.className="wp-info";let h=document.createElement("div");if(h.className="wp-title",h.textContent=a.title,i.appendChild(h),a.subtitle){let n=document.createElement("div");n.className="wp-subtitle",n.textContent=a.subtitle,i.appendChild(n)}if(r.appendChild(i),this.options.showDuration&&a.duration){let n=document.createElement("span");n.className="wp-duration",n.textContent=a.duration,r.appendChild(n)}if(r.addEventListener("click",()=>{s===this.currentTrackIndex?this.player&&this.player.isPlaying?this.player.pause():this.player&&this.player.play():this.selectTrack(s)}),t.appendChild(r),a.chapters.length>0&&this.options.expandChapters){let n=document.createElement("ul");n.className="wp-chapters",n.dataset.trackIndex=s,n.style.display="none",a.chapters.forEach((c,d)=>{let o=document.createElement("li");o.className="wp-chapter",o.dataset.time=c.time,o.dataset.index=d;let m=document.createElement("span");m.className="wp-chapter-time",m.textContent=this.formatTime(c.time),o.appendChild(m);let y=document.createElement("span");y.className="wp-chapter-label",y.textContent=c.label,o.appendChild(y),o.addEventListener("click",k=>{k.stopPropagation(),this.seekToChapter(s,c.time)}),n.appendChild(o)}),t.appendChild(n)}}),e.appendChild(t),this.container.appendChild(e),this.listElement=t}createMinimalControls(){let e=document.createElement("div");e.className="wp-controls",this.tracks.forEach((t,a)=>{let s=document.createElement("button");s.className="wp-track-btn",s.dataset.index=a,s.textContent=t.title,s.addEventListener("click",()=>this.selectTrack(a)),e.appendChild(s)}),this.container.appendChild(e),this.listElement=e}selectTrack(e){if(e<0||e>=this.tracks.length)return;let t=this.tracks[e];this.currentTrackIndex=e,this.currentChapterIndex=-1;let a=t.markers;(this.options.showChapterMarkers||this.options.showChapterMarkers===null&&this.tracks.length===1&&t.chapters.length>0)&&t.chapters.length>0&&a.length===0&&(a=t.chapters.map(r=>({time:r.time,label:r.label,color:r.color||this.options.chapterMarkerColor}))),this.player&&this.player.loadTrack(t.url,t.title,t.subtitle,{markers:a,artwork:t.artwork,album:t.album,onPlay:()=>{this.isPlaying=!0,this.setActiveTrack(this.currentTrackIndex),this.updatePlayState()},onPause:()=>{if(this.isPlaying=!1,this.updatePlayState(),this.player&&this.player.audio){let r=this.player.audio.currentTime,i=this.player.audio.duration;r>=i-.1&&(this.currentChapterIndex=-1,this.updateActiveChapter(0))}}}),this.setActiveTrack(e),this.options.expandChapters&&this.tracks.length>1&&this.listElement.querySelectorAll(".wp-chapters").forEach((r,i)=>{r.style.display=i===e?"block":"none"})}seekToChapter(e,t){e!==this.currentTrackIndex?(this.selectTrack(e),setTimeout(()=>{this.player.seekTo(t),this.player.isPlaying||this.player.play()},100)):(this.player.seekTo(t),this.player.isPlaying||this.player.play())}setActiveTrack(e){this.isMinimal?this.listElement.querySelectorAll(".wp-track-btn").forEach((t,a)=>{t.classList.toggle("wp-active",a===e)}):this.tracks.length>1&&this.listElement.querySelectorAll(".wp-item").forEach((t,a)=>{t.classList.toggle("wp-active",a===e)})}onTrackEnd(){this.currentChapterIndex=-1,this.updateActiveChapter(0),this.options.continuous&&this.currentTrackIndex<this.tracks.length-1&&this.selectTrack(this.currentTrackIndex+1)}nextTrack(){this.currentTrackIndex<this.tracks.length-1&&this.selectTrack(this.currentTrackIndex+1)}previousTrack(){this.currentTrackIndex>0&&this.selectTrack(this.currentTrackIndex-1)}bindKeyboard(){document.addEventListener("keydown",e=>{if(!(!this.container.contains(document.activeElement)&&!this.player?.container.contains(document.activeElement))){switch(e.key.toLowerCase()){case"n":this.tracks.length>1&&(e.preventDefault(),this.nextTrack());break;case"p":this.tracks.length>1&&(e.preventDefault(),this.previousTrack());break}if(this.tracks.length>1&&e.key>="1"&&e.key<="9"){let t=parseInt(e.key)-1;t<this.tracks.length&&(e.preventDefault(),this.selectTrack(t))}}})}parseTime(e){let t=e.split(":").map(Number);return t.length===2?t[0]*60+t[1]:t[0]||0}formatTime(e){let t=Math.floor(e/60),a=Math.floor(e%60);return`${t}:${a.toString().padStart(2,"0")}`}extractTitleFromUrl(e){if(!e)return"Untitled";let t=e.split("/");return t[t.length-1].split(".")[0].replace(/[-_]/g," ")}generateId(){return Math.random().toString(36).substring(2,9)}getPlayer(){return this.player}getCurrentTrackIndex(){return this.currentTrackIndex}getTracks(){return this.tracks}destroy(){this.player&&this.player.destroy(),this.container.innerHTML="",this.container.classList.remove("waveform-playlist","wp-minimal"),this.tracks.forEach(e=>{e.element&&(e.element.style.display="")}),this.player=null,this.listElement=null,this.tracks=[]}};function u(){if(typeof document>"u")return;document.querySelectorAll("[data-waveform-playlist]").forEach(e=>{if(e.dataset.waveformPlaylistInitialized!=="true")try{new p(e),e.dataset.waveformPlaylistInitialized="true"}catch(t){console.error("Failed to initialize WaveformPlaylist:",t)}})}if(typeof document<"u"){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",u);else if(typeof window<"u"&&window.WaveformPlayer)u();else if(typeof window<"u"){let l=setInterval(()=>{window.WaveformPlayer&&(clearInterval(l),u())},100);setTimeout(()=>clearInterval(l),5e3)}}p.init=u;typeof window<"u"&&(window.WaveformPlaylist=p);var b=p;return T(x);})();
/**
 * WaveformPlaylist
 * Playlist and chapter navigation for WaveformPlayer
 *
 * @version 1.0.0
 * @author ArrayPress
 * @license MIT
 */
